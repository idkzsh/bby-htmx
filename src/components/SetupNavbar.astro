---
let columns = Number(Astro.url.searchParams.get("numOfSKUs") || 1);
---

<div class="w-48 h-screen bg-neutral-100 flex flex-col items-center pt-1">
  <div
    hx-get="/"
    hx-target="body"
    hx-swap="outerHTML transition:true"
    hx-push-url="true"
    class="cursor-pointer"
  >
    <img src="/bby-logo.png" alt="" class="w-[50px]" />
  </div>

  <div class="flex flex-col gap-3 justify-between h-full py-4 w-[90%]">
    <div class="flex flex-col justify-between h-full">
      <div class="flex flex-col gap-2">
        <div
          class="flex border bg-white rounded-md justify-between items-center text-sm p-2 gap-2"
        >
          <button
            class="flex justify-center border w-[25px] rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white disabled:text-gray-400"
            id="decrement-columns"
            disabled={columns <= 1}
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              width="15"
              height="25"
              fill="teal"
            >
              <path d="M5 11H19V13H5z"></path>
            </svg>
          </button>
          SKUs: {columns}
          <svg class="hidden animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24" id="spinner-cols" width="5" height="15">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <button
            class="flex justify-center border w-[25px] rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white disabled:text-gray-400"
            id="increment-columns"
            disabled={columns >= 50}
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              width="15"
              height="25"
              fill="teal"
            >
              <path d="M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"></path>
            </svg>
          </button>
        </div>
        <a
          href="/contact"
          target="_blank"
          class="flex border bg-white rounded-md justify-between items-center hover:bg-gray-200 text-sm p-2 gap-2"
          >Contact Us
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="15"
            height="25"
            fill="teal"
            ><path
              d="M3 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3ZM20 7.23792L12.0718 14.338L4 7.21594V19H20V7.23792ZM4.51146 5L12.0619 11.662L19.501 5H4.51146Z"
            ></path></svg
          >
        </a>
        <a
          href="/faq"
          target="_blank"
          class="flex border bg-white rounded-md justify-between items-center hover:bg-gray-200 text-sm p-2 gap-2"
          >FAQs
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="15"
            height="25"
            fill="teal"
            ><path
              d="M12 19C12.8284 19 13.5 19.6716 13.5 20.5C13.5 21.3284 12.8284 22 12 22C11.1716 22 10.5 21.3284 10.5 20.5C10.5 19.6716 11.1716 19 12 19ZM12 2C15.3137 2 18 4.68629 18 8C18 10.1646 17.2474 11.2907 15.3259 12.9231C13.3986 14.5604 13 15.2969 13 17H11C11 14.526 11.787 13.3052 14.031 11.3989C15.5479 10.1102 16 9.43374 16 8C16 5.79086 14.2091 4 12 4C9.79086 4 8 5.79086 8 8V9H6V8C6 4.68629 8.68629 2 12 2Z"
            ></path></svg
          >
        </a>
        <a href="https://partners.bestbuy.com/web/guest"
        class="flex border bg-white rounded-md justify-between items-center hover:bg-gray-200 text-sm p-2 gap-2"
        target="_blank"
        >BBY Partner Portal
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 100 60"
          width="20"
          height="25"
          class="fill-yellow-400"
          style="transform: rotate(5deg);"
        >
          <path
            d="M95 5H15L5 20v20l10 15h80c2.76 0 5-2.24 5-5V10c0-2.76-2.24-5-5-5zM20 30c0-2.76 2.24-5 5-5s5 2.24 5 5-2.24 5-5 5-5-2.24-5-5z"
          ></path>
        </svg></a
      >
      </div>
      <button
        id="submit-handsontable"
        form="uploadForm"
        type="button"
        class="bg-black text-white rounded-md p-1 hover:opacity-80 flex gap-2 items-center justify-center"
      >
        Next
        <svg class="hidden animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24" id="spinner">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const submitButton = document.getElementById("submit-handsontable");
    submitButton?.addEventListener("click", function () {
      const event = new CustomEvent("submit-handsontable");
      document.dispatchEvent(event);
    });
    const incrementButton = document.getElementById("increment-columns");
    incrementButton?.addEventListener("click", function () {
      const urlParams = new URLSearchParams(window.location.search);
      let columns = Number(urlParams.get("numOfSKUs") || 1);
      columns++;
      urlParams.set("numOfSKUs", columns.toString());
      const newUrl = `${window.location.pathname}?${urlParams.toString()}`;
      window.location.href = newUrl;
    });
    const decrementButton = document.getElementById("decrement-columns");
    decrementButton?.addEventListener("click", function () {
      const urlParams = new URLSearchParams(window.location.search);
      let columns = Number(urlParams.get("numOfSKUs") || 1);
      columns <= 1 ? columns : columns--;
      urlParams.set("numOfSKUs", columns.toString());
      const newUrl = `${window.location.pathname}?${urlParams.toString()}`;
      window.location.href = newUrl;
    }
    );

    const showSpinner = () => {
      document.getElementById("spinner-cols")?.classList.remove("hidden");
    };

    incrementButton?.addEventListener("click", showSpinner);
    decrementButton?.addEventListener("click", showSpinner);
    document.getElementById("spinner-cols")?.classList.add("hidden");
  });
</script>
