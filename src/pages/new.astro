---
import { d } from "../data/hierarchy";
import Layout from "../layouts/Layout.astro";
const isHTMXRequest = Astro.request.headers.get("HX-Request") === "true";
---

{
  isHTMXRequest ? (
    <form
      hx-get="/subcategory"
      hx-target="#main"
      hx-swap="innerHTML transition:true"
      hx-trigger="submit"
      hx-push-url="true"
      class="border rounded-md flex flex-col p-4 gap-4 shadow-md font-normal text-base tracking-tight"
      id="new"
    >
      <label for="email">Email</label>
      <input
        name="email"
        id="email"
        type="email"
        autocomplete="email"
        class="border rounded-md p-1 w-80"
      />
      <label for="department">Product Type</label>
      <select
        name="department"
        id="department"
        class="border h-10 rounded-md px-2 overflow-hidden w-80"
      >
        {d.map((category, index) => (
          <option value={category.dept} title={category.value}>
            {category.value.length > 40
              ? category.value.slice(0, 37) + "..."
              : category.value}
          </option>
        ))}
      </select>

      <label for="numOfSKUs"># of SKUs</label>
      <input
        name="numOfSKUs"
        id="numOfSKUs"
        type="number"
        class="border rounded-md p-1"
      />
      <button
        type="submit"
        form="new"
        id="submit"
        class="flex gap-2 items-center justify-center w-80 hover:opacity-80 bg-black text-white rounded-md p-2"
      >

        Submit
        <svg class="hidden animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24" id="spinner">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </button>
    </form>

    <script>
      document.getElementById("spinner")?.classList.add("hidden");
      document.getElementById("submit")?.addEventListener("click", (event) => {
        document.getElementById("spinner")?.classList.remove("hidden");
      });
    </script>
  ) : (
    <Layout>
      <main
        class="flex flex-col w-[89.5%] h-[98%] bg-white mt-2 rounded-md border justify-center items-center gap-8 font-bold tracking-tight text-3xl"
        id="main"
      >
        <form
          hx-get="/subcategory"
          hx-target="#main"
          hx-swap="innerHTML transition:true"
          hx-trigger="submit"
          hx-push-url="true"
          class="border rounded-md flex flex-col p-4 gap-4 shadow-md font-normal text-base tracking-tight"
          id="new"
        >
          <label for="email">Email</label>
          <input
            name="email"
            id="email"
            type="email"
            autocomplete="email"
            class="border rounded-md p-1 w-80"
          />
          <label for="department">Product Type</label>
          <select
            name="department"
            id="department"
            class="border h-10 rounded-md px-2 overflow-hidden w-80"
          >
            {d.map((category, index) => (
              <option value={category.dept} title={category.value}>
                {category.value.length > 40
                  ? category.value.slice(0, 37) + "..."
                  : category.value}
              </option>
            ))}
          </select>
          <label for="numOfSKUs"># of SKUs</label>
          <input
            name="numOfSKUs"
            id="numOfSKUs"
            type="number"
            class="border rounded-md p-1"
          />
          <button
            type="submit"
            form="new"
            id="submit"
            class="flex gap-2 items-center justify-center w-80 hover:opacity-80 bg-black text-white rounded-md p-2"
          >
            Submit
            <svg class="hidden animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24" id="spinner">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </button>
        </form>
      </main>
    </Layout>

<script>
      document.getElementById("spinner")?.classList.add("hidden");
      document.getElementById("submit")?.addEventListener("click", (event) => {
        document.getElementById("spinner")?.classList.remove("hidden");
      });
    </script>
  )
}
